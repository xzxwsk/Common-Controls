function setIframe(a,c){$("#cutImgIframe").height(a+40);c&&$("#cutImgIframe").width(c)}(function(a){"function"===typeof define&&define.amd?define(["jquery"],a):a(jQuery)})(function(a){var c=function(b,c,g){if(!(1>g.length)){var k=null,url=""http://cimg.eluyou.cc/",f=null,l=b.ImgType?b.ImgType:["gif","jpeg","jpg","bmp","png"],e="",p=function(b){var c,d,e,f,h=a("#cutImgPop #cropImg").data("ratio");0<parseInt(b.w)&&(c=Math.floor(parseInt(b.x)*h),d=Math.floor(parseInt(b.y)*h),e=Math.ceil(parseInt(b.w)*h),f=Math.ceil(parseInt(b.h)*h));a("#cutImgPop #x").val(c);a("#cutImgPop #y").val(d);a("#cutImgPop #width").val(e);a("#cutImgPop #height").val(f)},q=function(){var g="";1>a("#cutImgPop").length&&(g='<div class="modal fade" id="cutImgPop" tabindex="-1" role="dialog" aria-labelledby="basicModal" aria-hidden="true"><div class="modal-dialog" style="width:630px;"><div class="modal-content"><div class="modal-header clearfix"><a class="close" data-dismiss="modal">&times;</a><div class="modal-title">\u56fe\u7247\u5904\u7406</div></div><div class="modal-body clearfix"><div class="container col-xs-12"><form enctype="multipart/form-data" method="post" name="fileForm" id="fileForm"><div class="row"><input type="file" name="file_upload" id="file_upload" /><input type="hidden" name="accno" id="accno" /><input type="hidden" name="key" id="key" /><input type="hidden" name="sign" id="sign" /></div></form><div class="row"><div class="progress" style="display:none;margin-top:20px;margin-bottom:0;"><div class="progress-bar" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"><span class="sr-only">0% Complete</span></div></div></div><form name="dataForm" id="dataForm" method="post"><div class="row"><br /> <img id="cropImg" style="display: none;max-width: 500px;max-height: 500px;" /><input type="hidden" name="x" id="x" /><input type="hidden" name="y" id="y" /><input type="hidden" name="width" id="width" /><input type="hidden" name="height" id="height" /><input type="hidden" name="filekey" id="filekey" /></div></form></div></div><div class="modal-footer"><input type="button" value="\u53d6\u6d88" class="btn" data-dismiss="modal" /><input type="submit" value="\u786e\u5b9a" class="btn btn-primary" id="cutImgConfirm" /></div></div></div></div>',a("body").append(g),a("#cutImgPop").modal("show"),a("#cutImgPop #cutImgConfirm").click(function(){a("#cutImgPop #dataForm").submit()}));a("#cutImgPop").on("hide.bs.modal",function(){setTimeout(function(){a("#cutImgPop").remove()},500)});b=jQuery.extend({},{aspectRatio:0,allowSelect:!0,allowResize:!0,allowMove:!0,keySupport:!1,boxWidth:600,boxHeight:600,minSize:[80,80],maxSize:[350,350],onSelect:p},b);for(var n in l)e+="image/"+l[n],n<l.length-1&&(e+=",");a("#cutImgPop #file_upload").attr("accept",e);a("#cutImgPop #key").val(b.key);a("#cutImgPop #accno").val(b.accno);a("#cutImgPop #sign").val(b.sign);a("#cutImgPop #fileForm").ajaxForm({type:"POST",dataType:"json",url:url+"saveImage",beforeSubmit:function(){a(".progress").show();var b=0;k=setInterval(function(){99>b&&(b++,a("#cutImgPop .progress-bar").width(b+"%"),a("#cutImgPop .sr-only").text(b+"% Complete"))},500)},success:function(d){if("seccuss"!=d.status)a("#cutImgPop").modal("hide"),alert(d.msg);else{a("#cutImgPop .progress-bar").width("100%");clearInterval(k);k=null;f&&(f.destroy(),f=null);a("#cutImgPop #cropImg").removeAttr("style");a("#cutImgPop #cropImg").attr("src",d.url);a("#cutImgPop #cropImg").css("max-width",b.boxWidth);a("#cutImgPop #cropImg").css("max-height",b.boxHeight);a("#cutImgPop #filekey").val(d.filekey);var c=new Image;c.src=d.url;c.onload=function(){var d=Math.max(1,this.width/a("#cutImgPop #cropImg").width());a("#cutImgPop #cropImg").show();setTimeout(function(){a("#cutImgPop .progress").fadeOut()},1E3);a("#cutImgPop #cropImg").width(a("#cutImgPop #cropImg").width());a("#cutImgPop #cropImg").height(a("#cutImgPop #cropImg").height());a("#cutImgPop #cropImg").data("ratio",d);f=a.Jcrop("#cutImgPop #cropImg",b)}}},failure:function(a){alert("\u7f51\u7edc\u8fde\u63a5\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5!")}});a("#cutImgPop #file_upload").change(function(){a("#cutImgPop #fileForm").submit()});a("#cutImgPop #dataForm").ajaxForm({dataType:"json",method:"post",url:url+"cutImage",beforeSubmit:function(){if(""==a("#cutImgPop #filekey").val()||void 0==a("#cutImgPop #filekey").val())return console.log("\u8bf7\u9009\u62e9\u56fe\u7247"),!1},success:function(b){"error"==b.status?alert("\u4e0a\u4f20\u5931\u8d25!"):(c(b),a("#cutImgPop").modal("hide"),setTimeout(function(){a("#cutImgPop .progress").hide();a("#cutImgPop .progress-bar").width("0%");a("#cutImgPop .sr-only").text("0% Complete")},500))},failure:function(a){alert("\u7f51\u7edc\u8fde\u63a5\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5!")}})};g.on("click",function(){q()})}};jQuery.fn.fnImageCrop=function(a,m){2>arguments.length&&(m=a,a={});return new c(a,m,this)}});